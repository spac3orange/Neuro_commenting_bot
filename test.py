import requests
import json
from pprint import pprint
import re


def append_to_text_file(value, filename='responses.txt'):
    # –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ñ–∞–π–ª –≤ —Ä–µ–∂–∏–º–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è. –ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –æ–Ω –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω.
    with open(filename, 'a', encoding='utf-8') as file:
        # –î–æ–±–∞–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É –≤ —Ñ–∞–π–ª
        file.write(value + '\n')


def format_text(resp_text):
    # –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–∞—á–∞–ª–∞ —Å—Ç—Ä–æ–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–µ–π—Å—è —Å –ø—Ä–æ–±–µ–ª–æ–≤ –∏ 1., 2., 3., 4., –∏–ª–∏ 5.
    if re.match(r"^\s*[1-9]\.", resp_text):
        # –û–±—Ä–µ–∑–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –≤–∏–¥–∞ "1. " –¥–æ –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–æ–±–µ–ª–∞ –ø–æ—Å–ª–µ —Ç–æ—á–∫–∏
        resp_text = re.sub(r"^\s*[1-9]\.\s*", "", resp_text)
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –∫–∞–≤—ã—á–µ–∫, –µ—Å–ª–∏ —Ç–µ–∫—Å—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–∫–ª—é—á–µ–Ω –≤ –æ–¥–∏–Ω –∏–∑ –≤–∏–¥–æ–≤ –∫–∞–≤—ã—á–µ–∫
    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ–¥–∏–Ω–∞—Ä–Ω—ã–µ (' '), –¥–≤–æ–π–Ω—ã–µ (" "), –∏ —É–≥–ª–æ–≤—ã–µ (¬´ ¬ª) –∫–∞–≤—ã—á–∫–∏
    if re.match(r"^['\"]", resp_text) and re.search(r"['\"]$", resp_text):
        resp_text = resp_text[1:-1].strip()
    elif re.match(r"^¬´", resp_text) and re.search(r"¬ª$", resp_text):
        resp_text = resp_text[1:-1].strip()
    return resp_text.strip()


def get_req(prompt):
    url = "https://api.deepseek.com/v1/chat/completions"

    payload = json.dumps({
        "messages": [
            {"content": "You are a helpful assistant.", "role": "system"},
            {"content": prompt, "role": "user"}
        ],
        "model": "deepseek-chat",
        "frequency_penalty": 0,
        "max_tokens": 2048,
        "presence_penalty": 0,
        "stop": None,
        "stream": False,
        "temperature": 1,
        "top_p": 1
    })

    headers = {
        'Content-Type': 'application/json',
        'Accept': 'application/json',
        'Authorization': 'Bearer sk-00555d8174554646a11276b58553a664'
    }

    resp = requests.post(url, headers=headers, data=payload)
    return resp


req = '''
–ò–Ω–æ–≥–¥–∞ –∂–µ–Ω—â–∏–Ω—ã –≤–∏–¥—è—Ç –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã –≤ —ç—Ç–∏—Ö —ç–º–æ—Ü–∏—è—Ö, –ø—Ä–æ–æ—Ä–∞–ª–∞—Å—å, –≤—Å–µ–º —Ä–∞–∑–¥–∞–ª–∞, —Ö–æ—Ä–æ—à–µ–Ω—å–∫–æ —Ä–∞–∑–æ–∑–ª–∏–ª–∞—Å—å –∏ –ø–µ—Ä–µ–¥–µ–ª–∞–ª–∞ –∫—É—á—É –¥–µ–ª. –≠—Ç–æ —Ç–æ—Ç —Å–ª—É—á–∞–π, –∫–æ–≥–¥–∞ –ø—Å–∏—Ö–∞–Ω—É–ª–∞ –∏ –æ—Ç–¥—Ä–∞–∏–ª–∞ –≤—Å—é –∫–≤–∞—Ä—Ç–∏—Ä—É üôà –°–ø–æ—Ä—é, —á—Ç–æ —ç—Ç–æ –∑–Ω–∞–∫–æ–º–æ –∫–∞–∂–¥–æ–π üòÑ

–ù–æ –ø—Ä–æ–±–ª–µ–º–∞ –≤ —Ç–æ–º, —á—Ç–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∑–ª–æ—Å—Ç—å –∫–æ–ø–∏—Ç—Å—è. –¢–∞–∫–æ–π —Å–∏–ª—å–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ —ç–Ω–µ—Ä–≥–∏–∏ –æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞–∑—Ä—É—à–∞—é—â–µ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ —Å–∞–º—É –∂–µ–Ω—â–∏–Ω—É. –° –æ–¥–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã, –ø–æ—è–≤–ª—è—é—Ç—Å—è —Å–∏–ª—ã —Å–≤–µ—Ä–Ω—É—Ç—å –≥–æ—Ä—ã, –∞ —Å –¥—Ä—É–≥–æ–π ‚Äî –Ω–∞–∫–æ–ø–∏–≤—à–∞—è—Å—è –∑–ª–æ—Å—Ç—å –∏ –≥–Ω–µ–≤ –ª–æ–º–∞—é—Ç –∏–º–º—É–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É, –∞ —ç—Ç–æ —É–∂–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç –º–Ω–æ–≥–æ —Ä–∞–∑–Ω—ã—Ö –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤, –≤–ª–∏—è—é—â–∏—Ö –Ω–∞ –∑–¥–æ—Ä–æ–≤—å–µ –∂–µ–Ω—â–∏–Ω—ã. 
–¢–∞–∫–æ–π –≤–æ—Ç –ø–∞—Ä–∞–¥–æ–∫—Å ü§∑üèº‚Äç‚ôÄÔ∏è

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ –≤–æ–∑–¥—É—à–Ω—ã–π —à–∞—Ä–∏–∫, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤–æ–¥–æ–π. –°–Ω–∞—á–∞–ª–∞ –æ–Ω —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≥–ª–∞–¥–∫–∏–º, —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è. –ù–æ –µ—Å–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –µ–≥–æ –Ω–∞–ø–æ–ª–Ω—è—Ç—å, –æ–Ω –±—É–¥–µ—Ç –≤—Å—ë –±–æ–ª–µ–µ —Ç—è–∂—ë–ª—ã–º –∏ –≤ –∫–∞–∫–æ–π-—Ç–æ –º–æ–º–µ–Ω—Ç –ø—Ä–æ—Å—Ç–æ –ª–æ–ø–Ω–µ—Ç. 

–ü–æ—Ç–æ–º—É –æ—á–µ–Ω—å –≤–∞–∂–Ω–æ –Ω–∞—É—á–∏—Ç—å—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–≤–æ—é —ç–Ω–µ—Ä–≥–∏—é –ø—Ä–∞–≤–∏–ª—å–Ω–æ üôåüèº

–ì–Ω–µ–≤ ‚Äî —ç—Ç–æ —Ö–æ—Ä–æ—à–∞—è —ç–º–æ—Ü–∏—è, –æ–Ω–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–Ω–æ–≥–æ–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤ —ç—Ç–æ–º –º–∏—Ä–µ. –ì–ª–∞–≤–Ω–æ–µ, –ø—Ä–∏–º–µ–Ω—è—Ç—å –µ—ë —Ç–∞–∫, —á—Ç–æ–±—ã –æ–Ω–∞ –Ω–µ –¥–µ–π—Å—Ç–≤–æ–≤–∞–ª–∞ —Ä–∞–∑—Ä—É—à–∞—é—â–µ –Ω–∞ –Ω–∞—à —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –æ—Ä–≥–∞–Ω–∏–∑–º. 

–ù–µ—Ç –ø–ª–æ—Ö–∏—Ö —ç–º–æ—Ü–∏–π, –Ω—É–∂–Ω–æ —É–º–µ—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–æ–∂–∏–≤–∞—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ —Ä–∞–¥–æ—Å—Ç—å, –Ω–æ –∏ –≥—Ä—É—Å—Ç—å, –∑–ª–æ—Å—Ç—å, –Ω–µ–Ω–∞–≤–∏—Å—Ç—å. –û–Ω–∏ –≤—Å–µ —Å–æ—Å—Ç–∞–≤–ª—è—é—â–∏–µ –Ω–∞—à–µ–π –∂–∏–∑–Ω–∏ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –∫–∞–∫–∏—Ö-—Ç–æ ¬´–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö¬ª —á—É–≤—Å—Ç–≤ —Ç–æ–∂–µ –Ω–µ –ø—Ä–∏–≤–µ–¥—ë—Ç –Ω–∏ –∫ —á–µ–º—É —Ö–æ—Ä–æ—à–µ–º—É.  

–ù–∞ –≤–µ–±–∏–Ω–∞—Ä–µ ¬´–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è –∂–µ–Ω—Å–∫–æ–π —Å–∏–ª—ã¬ª 27 –∞–ø—Ä–µ–ª—è –º—ã –∑–∞—Ç—Ä–æ–Ω–µ–º —ç—Ç—É —Ç–µ–º—É. –ü–æ–≥–æ–≤–æ—Ä–∏–º, –∫–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å —Ä–∞–∑—Ä—É—à–∞—é—â–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è –∑–ª–æ—Å—Ç–∏ –∏ –≥–Ω–µ–≤–∞.

‚ÄºÔ∏è–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –≤–µ–±–∏–Ω–∞—Ä –ø–æ —Å—Å—ã–ª–∫–µüëáüèº
https://clck.ru/3ACDUR
'''
prompt = '''
–í—ã–±–µ—Ä–∏ –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –ø–æ —Å–º—ã—Å–ª—É –ø—Ä–æ–º—Ç –∫ —Å–æ–æ–±—â–µ–Ω–∏—é –≤—ã—à–µ –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∏ –Ω–∞–ø–∏—à–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç –ª–∏—Ü–∞ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ –Ω–µ –±–æ–ª–µ–µ –æ–¥–Ω–æ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.
–ù–µ –ø–∏—à–∏ –≤ –Ω–∞—á–∞–ª–µ —Ü–∏—Ñ—Ä –∏–ª–∏ –∫–∞–∫–∏—Ö –ª–∏–±–æ –ø—Ä–µ–¥–∏—Å–ª–æ–≤–∏–π –Ω–∞–ø—Ä–∏–º–µ—Ä ('1. –°–ø–∞—Å–∏–±–æ –∑–∞ —Å–æ–≤–µ—Ç—ã, —è –ø—Ä–æ–±—É—é! '), —Ç–æ–ª—å–∫–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π.  –í–∞—Ä–∏–∞–Ω—Ç—ã:
1. –î–∞–π –¥–æ–±—Ä–æ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã–π –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Ü–∞. –†–∞–∑–º–µ—Ä –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–∞–≤–µ–Ω —à–µ—Å—Ç–∏ —Å–ª–æ–≤–∞–º. –ú–∞–∫—Å–∏–º—É–º –æ–¥–Ω–æ–º—É –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—é.
–í–µ–¥–∏ —Å–µ–±—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ –∏ –ø–æ–∑–∏—Ç–∏–≤–Ω–æ. –ù–µ –¥–µ–ª–∞–π –æ—Ü–µ–Ω–æ—á–Ω—ã—Ö —Å—É–∂–¥–µ–Ω–∏–π.
2. –ù–∞–ø–∏—à–∏ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å –∞–≤—Ç–æ—Ä—É –∫–∞–Ω–∞–ª–∞ –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Ü–∞. 
–†–∞–∑–º–µ—Ä –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–∞–≤–µ–Ω —Ç—Ä–µ–º —Å–ª–æ–≤–∞–º. –î–æ–±–∞–≤—å —Å–º–∞–π–ª–∏–∫ –≤ –∫–æ–Ω—Ü–µ. –í–µ–¥–∏ —Å–µ–±—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ –∏ –ø–æ–∑–∏—Ç–∏–≤–Ω–æ. –ù–µ –¥–µ–ª–∞–π –æ—Ü–µ–Ω–æ—á–Ω—ã—Ö —Å—É–∂–¥–µ–Ω–∏–π.
3. –î–∞–π –º—É–¥—Ä—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Ü–∞. –†–∞–∑–º–µ—Ä –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–∞–≤–µ–Ω —Ç—Ä—ë–º —Å–ª–æ–≤–∞–º. –ú–∞–∫—Å–∏–º—É–º –æ–¥–Ω–æ–º—É –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—é. –í–µ–¥–∏ —Å–µ–±—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ –∏ –ø–æ–∑–∏—Ç–∏–≤–Ω–æ.
4. –î–∞–π —ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Ü–∞. –†–∞–∑–º–µ—Ä –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–∞–≤–µ–Ω —à–µ—Å—Ç–∏ —Å–ª–æ–≤–∞–º. –í–µ–¥–∏ —Å–µ–±—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ –∏ –ø–æ–∑–∏—Ç–∏–≤–Ω–æ. –ù–µ –¥–µ–ª–∞–π –æ—Ü–µ–Ω–æ—á–Ω—ã—Ö —Å—É–∂–¥–µ–Ω–∏–π. –í–µ–¥–∏ —Å–µ–±—è –∫–∞–∫ —ç–∫—Å–ø–µ—Ä—Ç –≤ –æ–±–ª–∞—Å—Ç–∏ –Ω–∞—Å—Ç–∞–≤–Ω–∏—á–µ—Å—Ç–≤–∞ –∏ –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å—Å—Ç–≤–∞.
'''
full_req = req + prompt
response = get_req(full_req)
data = response.json()
text = data["choices"][0]["message"]["content"]
print(text)
form_rext = format_text(text)
print('final')
print(form_rext)
append_to_text_file(text)